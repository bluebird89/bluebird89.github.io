# 代码审查

一项确保软件质量的活动，是由一个或多个人通过查看和阅读部分源代码来检查程序的一种方式，代码审查通常发生在实现完成后或实现中间阶段。参与审查的人员中必须至少有一人不是代码的作者。执行审查的人员称之为“审查人”，但不包含作者本人。

* 提高代码质量
* 保持项目的一致性
* 发现 bug
* 学习（通过代码被审查）和教学（通过审查其他人的代码）
* 营造共同的责任感
* 通过他方查找代码中的小错误，防止这些小错误日积月累腐蚀代码
* 寻找更好的解决方案的常见方法

## 被审查者

* 代码审查不是为了评判或审查某个人的编程能力。“代码审查只关注代码”
* 避免
  - 将重构的代码和新代码的实现混合在一起
  - 在提交功能变更时，重新格式化整个代码库
  - 提交代码时不写提交注释（我会在后面讨论该话题）
  - 在一次代码审核（或一次代码提交）中提交多个功能
* 注意
  - 单独提交代码清理命令（重新格式化或修复拼写错误等）和重构:代码是否与提交注释相符
  - 编写相关的提交说明
  - 只提交准备好审查的代码
  - 审查期间不要更改代码
  - 确保你的代码通过了自己的审查，并且你没有发现任何明显的问题，可以放心地合并代码（如果你发现了问题，并想讨论某些内容，那么提前跟你的审核者打招呼）；
  - 代码中没有混合不相干的变更，不会太长也不会增加阅读难度；
  - 针对代码变更写好提交注释，明确交待变更的目的
* 快速完成功能，大家写代码的时候都没有思考太多 =》 自己的代码马上就要被别人审视， 就像开源软件一样，写得小心翼翼了

```md
XXX：添加一些新功能（简短的说明）

对于代码实现更为详细的描述
你可以写很多行，但还可以包括：
* 项目符号
* 不同的细节
* 如果你有很多点，一行写不下，那么也可以在各个点之间插入空行

引用与之相关的问题
```

## 审查者

* 性能（如果是在同一个代码库的话，通常不那么重要）
* 可读性（恕我直言，这几乎是最重要的）
* 尝试覆盖比被审查的解决方案更多的极端情况
* 是否可以用更好的代码样式（比如更多可重用的代码）来实现相同的功能
* 代码测试
  - 验证它们是否在测试正确的东西
  - 变更后的 API 的使用方法以及测试用例是否合理。
  - 通过单元测试我们就能看出实现的使用方法。
* 安全：代码都需要拥有某种安全机制（例如 OAUTH 层，或 REST 控制器的 BASIC
* 保持友好
* 审查代码，而不是写代码的人
* 评语要简洁准确
* 在最后不要忘了为好的代码点赞
* 表明你是否需要等代码修改完毕后再看一次（如果你们的审查工具不支持这一功能的话）

## QA评审底层测试

* QA评审底层测试的价值体现：
  - 最重要的是利用QA的测试技能，可以发现Dev所写底层测试可能存在的问题，让测试更有效。
  - QA通过review底层测试，能够更好的了解测试覆盖情况，更清楚整体的测试状态。
  - QA看Dev写的测试，可以起到督促他们编写测试的作用。
* 对Dev要求：
  - 自己要能清晰理解所有的测试，比如换人结对后，可能对原来同学写的测试没有搞清楚，当然没办法给QA讲清楚；
  - 能清晰的介绍所写测试，包括对应的测试点、哪些点在单元测试覆盖、哪些在集成测试覆盖等；
  - 要能系统的给QA去演示，不是直接打开IDE让QA自己去看，也不是东一个西一个想起哪个给演示哪个，把QA搞晕了。
* 从QA的角度，要想把测试搞清楚，有下面几个要求：
  - 对测试分层等测试策略的理解，需要能够判断出哪些应该写单元测试、哪些写集成测试；
  - 对于底层代码结构的理解，了解单元测试和API集成测试的实现形式，倒不一定要自己去实现，只是要做到能看懂能理解。
  - 对于测试点的把握，比如对所验收用户故事的测试点要做到心中有数，能够清楚的知道需要有哪些测试来覆盖，帮助发现是否有遗漏的测试。
  - 还有就是一些基本测试编写技巧的掌握，比如说测试命名、测试验证点是否正确、测试是否有冗余等。
  - 如果QA对于技术实现不是很了解，可以加强与Dev的沟通，让Dev帮忙介绍更多的上下文以帮助更好的理解。因此，对主动性和沟通能力都有要求。

## 工具

* Phabricator
* ReviewNinja
* Codacy
* RhodeCode
* Gerrit
* [ reviewdog / reviewdog ](https://github.com/reviewdog/reviewdog):dog Automated code review tool integrated with any code analysis tools regardless of programming language https://medium.com/@haya14busa/reviewdog-a-code-review-dog-who-keeps-your-codebase-healthy-d957c471938b#.8xctbaw5u

## 方法

* CheckStyle
* Check List
* 小步快跑：控制每次Review代码的数量
