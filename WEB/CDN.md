# CDN Content Delivery Network，内容分发网络

CDN 是构建在网络之上的内容分发网络，依靠部署在各地的边缘服务器，通过中心平台的负载均衡、内容分发、调度等功能模块，使用户就近获取所需内容，降低网络拥塞，提高用户访问响应速度和命中率

* 核心技术
    - 内容存储技术
    - 内容分发技术
    - 负载均衡技术
* 优势
    - 加速：基于 CDN 各节点，就近获取内容
    - 降低负载：基于 CDN 缓存，减少源站的访问
    - 成本低：费用成本、部署成本
    - 可扩展性强：基于边缘计算
* 原理
    - 存储：基于 URL 的维度进行 Hash 运算后生成唯一的字符，基于该字符进行缓存的获取与存储。
    - 当涉及静态资源的更新操作的时候，更多的除了使用 URL 维度外，还会依靠附加参数的形式，进行 CDN 缓存的“更新”。但这个“更新”实际是静态资源生成新的 CDN 缓存。维度的增加也同样意味着 CDN 缓存命中率的降低。
    - CDN 服务商会在资源请求的 Response Headers 中输出一些涉及缓存命中、CDN 节点、Hash字符、过期时间等信息。
    - 刷新预热（即：清理 CDN 缓存） 通过提供文件 URL 或目录的方式，强制CDN节点回源拉取最新的文件。 将指定的内容主动预热到 CDN 的节点上，用户首次访问即可直接命中缓存，降低源站压力。一般大规模迁移的时候，会使用到
* 功能
    - 自定义缓存过期时间规则：支持配置自定义资源的缓存过期时间规则, 支持指定路径或者文件名后缀方式, 支持 Header 输出缓存过期时间
    - 自定义 header 头：如 Access-Control-Allow-Origin: * 以实现跨域
    - 自定义页面：支持设置404、403、503、504等页面
    - 页面优化：去除HTML页面页面冗余内容如注释以及重复的空白符
    - 智能压缩：对静态文件类型进行压缩, 有效减少用户传输内容大小
    - 访问控制：Refer防盗链、IP 黑/白名单等
    - HTTPS 支持
    - 统计分析、日志管理
    - 人工智能服务：识图、鉴黄等
* 应用
    - 后端加速（缓存）—— 自定义缓存时间。动态文件（eg：php | jsp | asp），建议设置缓存时间为 0s，即不缓存；若动态文件例如 php 文件内容更新频率较低，推荐设置较短缓存时间
* 边缘计算
    - 在靠近物或数据源头的一侧，采用网络、计算、存储、应用核心能力为一体的开放平台，就近提供最近端服务。
    - 其应用程序在边缘侧发起，产生更快的网络服务响应，满足行业在实时业务、应用智能、安全与隐私保护等方面的基本需求。
    - 边缘计算处于物理实体和工业连接之间，或处于物理实体的顶端。而云端计算，仍然可以访问边缘计算的历史数据。
* 图片 WEBP 原理
    - 开启 CDN Header - Accept 回源
    - 获取 Request Headers 中 Accept 中包含 image/webp（即为支持webp）
    - 通过边缘计算方式，通过源站获取对应素材转换为 webp 格式，并存储至对应 CDN 节点
    - 用户通过 CDN 输出对应格式

![原理](../_static/cdn.jpg "Optional title")

## Tool

* [justjavac/ReplaceGoogleCDN](https://github.com/justjavac/ReplaceGoogleCDN):♋️ 一个 Chrome 插件：将 Google CDN 替换为国内的
